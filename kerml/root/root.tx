/* Elements */
Model:
    ( elements*=Element | relationships+=Relationship)
;

Element:
    'element' ('<' humanId=Name '>')? ( name=Name )?
    (';' | '{'
        (   ownedRelationship += OwnedRelationship
            | ownedRelationship += OwnedDocumentation
        )
    '}')
;

/* Relationships */
Relationship:
    'relationship' ('<' humanId=Name '>')? ( name=Name )?
        ('from' source+=[Element|QualifiedName][','])?
        ('to' target+=[Element|QualifiedName][','])?
    (';' | '{'
        ownedRelatedElement+=RelationshipOwnedElement
    '}')
;

OwnedRelationship:
    'relationship' ('<' humanId=Name '>')? ('to' target+=[Element|QualifiedName][','])?
    (';' | '{'
        ownedRelatedElement+=RelationshipOwnedElement
    '}')
;

RelationshipOwnedElement:
      Element | Relationship
;

/* =============================================================== */
/* Comments */
ModelComment:
	( 'comment' ('<' humanId=Name '>')? ( name=Name )?
	  'about' ownedRelationship += Annotation
      //{ ownedRelationship += annotation }
	  ( ',' ownedRelationship += Annotation )*
	  | ( 'comment' ('<' humanId=Name '>')? ( name=Name )? )?
	  ownedRelationship += ElementAnnotation
      //{ ownedRelationship += annotation }
	)
	body = /(?ms)\/\*(.*?)\*\//
;

Annotation:
	annotatedElement = [QualifiedName]
;

ElementAnnotation:
    type=[Annotation]
    annotatedElement = [Element]
;

/* =============================================================== */
/* DOCUMENTATION */
OwnedDocumentation:
    documentingComment=DocumentationComment
;

DocumentationComment:
    'doc' ('<' humanId = Name '>' )? body=/(?ms)\/\*(.*?)\*\//
;

PrefixDocumentation:
	documentingComment = PrefixDocumentationComment
;

PrefixDocumentationComment:
	( 'doc' ( '<' humanId = Name '>' )? )? body = /(?ms)\/\*\*(.*?)\*\//
;


/* =============================================================== */
/* COMMENTS */
Comment:
//    Note | RegularComment | DocumentationComment
    NoteBlock | NoteLine
;

NoteBlock:
    /\/\/\*(.|\n)*?\*\//
;

NoteLine:
    /\/\/.*$/
;

/*
REGULAR_COMMENT:
    commentText=/(?ms)\/\*(.*?)\*\//
;

DOCUMENTATION_COMMENT:
    commentText=/(?ms)\/\*\*(.*?)\*\//
;
*/

/* QualifiedNames */
Qualification
    : Name('::')+
    ;

QualifiedName
    : Qualification? Name
    ;

/* NAMES */
Name:
    !Keyword (BASIC_NAME | '\'' UNRESTRICTED_NAME '\'')
;

BASIC_NAME:
    /([a-zA-Z]|'_')([\w|\d]*)/
    ;

UNRESTRICTED_NAME:
    /((?!['"])([ -~])|(\\(b|t|n|f|r)))*/
    ;

DECIMAL_DIGIT:
    /\'[0-9]\'/
;

/* TERMINALS */
DECIMAL_VALUE
    : /'0'..'9' ('0'..'9')*/
    ;

EXP_VALUE
    : DECIMAL_VALUE ('e' | 'E') ('+' | '-')? DECIMAL_VALUE
	;

STRING_VALUE
    : /'"' ('\\' ('b' | 't' | 'n' | 'f' | 'r' | '"' | "'" | '\\') | !('\\' | '"'))* '"'/
    ;

Keyword:
    'element' | 'relationship' | 'from' | 'to' | 'doc'
;

//Keyword:
//    'about' | 'abstract' | 'alias' | 'all' | 'and' | 'as' | 'assign' | 'assoc' | 'behavior' | 'binding' | 'bool' | 'by' | 'class'
//    | 'classifier' | 'comment' | 'composite' | 'conjugate' | 'conjugates' | 'conjugation' | 'connector'
//    | 'datatype' | 'default' | 'disjoining' | 'disjoint' | 'doc' | 'element' | 'else' | 'end' | 'expr' | 'false'
//    | 'feature' | 'featured' | 'featuring' | 'filter' | 'first' | 'flow' | 'for' | 'from' | 'function' | 'generalization'
//    | 'hastype' | 'id' | 'if' | 'implies' | 'import' | 'in' | 'inout' | 'interaction' | 'inv' | 'is' | 'istype' | 'language'
//    | 'member' | 'metadata' | 'multiplicity' | 'namespace' | 'nonunique' | 'not' | 'null' | 'of' | 'or' | 'ordered' | 'out'
//    | 'package' | 'portion' | 'predicate' | 'private' | 'protected' | 'public' | 'redefines' | 'redefinition'
//    | 'relationship' | 'rep' | 'return' | 'specialization' | 'specializes' | 'step' | 'stream' | 'struct'
//    | 'subclassifier' | 'subset' | 'subsets' | 'subtype' | 'succession' | 'then' | 'to' | 'true' | 'type' | 'typed'
//    ;